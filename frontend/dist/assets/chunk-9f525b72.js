var e=Object.defineProperty,r=(r,t,n)=>(((r,t,n)=>{t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n})(r,"symbol"!=typeof t?t+"":t,n),n);import{R as t,j as n,r as o}from"./chunk-85d168d5.js";class a extends t.Component{constructor(e){super(e),r(this,"logErrorToService",async(e,r)=>{try{const t={message:e.message,stack:e.stack,componentStack:r.componentStack,timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href,userId:this.getUserId(),errorId:this.state.errorId};await fetch("/api/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){}}),r(this,"getUserId",()=>{try{const e=localStorage.getItem("token");if(e){return JSON.parse(atob(e.split(".")[1])).userId}}catch(e){return null}return null}),r(this,"handleReload",()=>{window.location.reload()}),r(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null})}),r(this,"handleGoHome",()=>{window.location.href="/"}),this.state={hasError:!1,error:null,errorInfo:null,errorId:null}}static getDerivedStateFromError(e){return{hasError:!0,errorId:Date.now().toString()}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r}),this.logErrorToService(e,r)}render(){if(this.state.hasError){const e=!1;return n.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Arial, sans-serif",padding:"20px"},children:n.jsxs("div",{style:{background:"white",borderRadius:"20px",padding:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",maxWidth:"800px",width:"100%",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"4rem",marginBottom:"20px"},children:"💥"}),n.jsx("h1",{style:{color:"#333",margin:"0 0 20px 0",fontSize:"2.5rem",background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Упс! Что-то пошло не так"}),n.jsx("p",{style:{color:"#666",fontSize:"1.1rem",marginBottom:"30px",lineHeight:"1.6"},children:"Произошла неожиданная ошибка. Мы уже получили уведомление об этой проблеме и работаем над её исправлением."}),this.state.errorId&&n.jsxs("div",{style:{background:"#f8f9fa",padding:"15px",borderRadius:"10px",border:"1px solid #e9ecef",marginBottom:"30px"},children:[n.jsx("strong",{style:{color:"#666"},children:"ID ошибки: "}),n.jsx("code",{style:{background:"#e9ecef",padding:"4px 8px",borderRadius:"4px",fontFamily:"monospace",color:"#495057"},children:this.state.errorId})]}),e,n.jsxs("div",{style:{display:"flex",gap:"15px",flexWrap:"wrap",justifyContent:"center"},children:[n.jsx("button",{onClick:this.handleRetry,style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"15px 30px",borderRadius:"25px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)"},onMouseOver:e=>e.target.style.transform="translateY(-2px)",onMouseOut:e=>e.target.style.transform="translateY(0)",children:"🔄 Попробовать снова"}),n.jsx("button",{onClick:this.handleReload,style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",border:"none",padding:"15px 30px",borderRadius:"25px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(240, 147, 251, 0.3)"},onMouseOver:e=>e.target.style.transform="translateY(-2px)",onMouseOut:e=>e.target.style.transform="translateY(0)",children:"🔃 Перезагрузить страницу"}),n.jsx("button",{onClick:this.handleGoHome,style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",border:"none",padding:"15px 30px",borderRadius:"25px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(79, 172, 254, 0.3)"},onMouseOver:e=>e.target.style.transform="translateY(-2px)",onMouseOut:e=>e.target.style.transform="translateY(0)",children:"🏠 На главную"})]}),n.jsxs("div",{style:{marginTop:"30px",padding:"20px",background:"#f8f9fa",borderRadius:"10px",border:"1px solid #e9ecef"},children:[n.jsx("h4",{style:{margin:"0 0 15px 0",color:"#333"},children:"💡 Что можно сделать:"}),n.jsxs("ul",{style:{textAlign:"left",color:"#666",lineHeight:"1.6",margin:0,paddingLeft:"20px"},children:[n.jsx("li",{children:"Попробуйте перезагрузить страницу"}),n.jsx("li",{children:"Проверьте подключение к интернету"}),n.jsx("li",{children:"Очистите кэш браузера и cookies"}),n.jsx("li",{children:"Если проблема повторяется, обратитесь в техподдержку"})]})]})]})})}return this.props.children}}const i=({onRetry:e,message:r="Ошибка сети"})=>n.jsxs("div",{style:{background:"linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)",padding:"30px",borderRadius:"15px",textAlign:"center",border:"2px solid #ff6b6b",margin:"20px 0"},children:[n.jsx("div",{style:{fontSize:"3rem",marginBottom:"15px"},children:"🌐❌"}),n.jsx("h3",{style:{color:"#721c24",margin:"0 0 15px 0",fontSize:"1.5rem"},children:r}),n.jsx("p",{style:{color:"#856404",margin:"0 0 20px 0",lineHeight:"1.5"},children:"Не удалось подключиться к серверу. Проверьте подключение к интернету."}),n.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center",flexWrap:"wrap"},children:[n.jsx("button",{onClick:e,style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"20px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)"},onMouseOver:e=>e.target.style.transform="translateY(-2px)",onMouseOut:e=>e.target.style.transform="translateY(0)",children:"🔄 Повторить запрос"}),n.jsx("button",{onClick:()=>window.location.reload(),style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"20px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(240, 147, 251, 0.3)"},onMouseOver:e=>e.target.style.transform="translateY(-2px)",onMouseOut:e=>e.target.style.transform="translateY(0)",children:"🔃 Обновить страницу"})]})]}),s=({message:e="Загрузка...",size:r="medium"})=>{const t={small:{width:"30px",height:"30px",borderWidth:"3px"},medium:{width:"50px",height:"50px",borderWidth:"4px"},large:{width:"80px",height:"80px",borderWidth:"6px"}},o=t[r]||t.medium;return n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 20px",textAlign:"center"},children:[n.jsx("div",{style:{width:o.width,height:o.height,border:`${o.borderWidth} solid #f3f3f3`,borderTop:`${o.borderWidth} solid #667eea`,borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),n.jsx("p",{style:{color:"#666",fontSize:"1.1rem",margin:0,fontWeight:"500"},children:e}),n.jsx("style",{children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      "})]})},l=()=>(o.useState(!1),null),d=(e,r={})=>{const{fallback:a=n.jsx(s,{message:"Загружаем..."}),retryCount:i=3,retryDelay:l=1e3}=r;return t.memo(r=>{const[s,d]=t.useState(null),[c,p]=t.useState(0),[x,h]=t.useState(!1),g=t.useMemo(()=>o.lazy(async()=>{h(!0);try{const r=await e();return d(null),p(0),r}catch(r){if(c<i)return p(e=>e+1),await new Promise(e=>setTimeout(e,l*(c+1))),e();throw d(r),r}finally{h(!1)}}),[c]),u=()=>{d(null),p(0),h(!1)};return s&&c>=i?n.jsxs("div",{style:{padding:"40px",textAlign:"center",background:"#fff5f5",border:"1px solid #fed7d7",borderRadius:"10px",margin:"20px 0"},children:[n.jsx("div",{style:{fontSize:"3rem",marginBottom:"20px"},children:"⚠️"}),n.jsx("h3",{style:{color:"#c53030",marginBottom:"15px"},children:"Ошибка загрузки компонента"}),n.jsxs("p",{style:{color:"#744210",marginBottom:"20px"},children:["Не удалось загрузить компонент после ",i," попыток."]}),n.jsx("button",{onClick:u,style:{background:"#3182ce",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",fontSize:"1rem"},children:"Попробовать снова"})]}):n.jsx(o.Suspense,{fallback:a,children:n.jsx(g,{...r})})})},c=(e=[])=>{const[r,n]=t.useState(new Set),o=t.useCallback(async(e,t)=>{if(!r.has(t))try{await e(),n(e=>new Set([...e,t]))}catch(o){}},[r]),a=t.useCallback(async e=>{const r=Object.entries(e).map(([e,r])=>o(r,e));await Promise.allSettled(r)},[o]);return t.useEffect(()=>{e.length>0&&e.forEach((e,r)=>{o(e,`component_${r}`)})},[e,o]),{preloadComponent:o,preloadMultiple:a,preloadedComponents:Array.from(r)}};export{a as E,s as L,i as N,l as a,c as u,d as w};
